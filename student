<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Proposal Scheduler - Student</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
</head>
<body>
<h1>Student Panel - Proposal Scheduler</h1>

<form id="studentForm">
  <label>Your Name: <input type="text" id="studentName" required></label><br>
  <label>Partner Name: <input type="text" id="partnerName" required></label><br>
  <button type="submit">Get Random Slot</button>
</form>

<h3>Your Assigned Slot</h3>
<p id="assignedSlot"></p>

<script>
  // --- Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDEy8nt5mUtEP-zSAQlVI14OUloe_oAixY",
    authDomain: "proposal-scheduler1.firebaseapp.com",
    databaseURL: "https://proposal-scheduler1-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "proposal-scheduler1.firebasestorage.app",
    messagingSenderId: "111950321382",
    appId: "1:111950321382:web:0ee3a4be46b15d66fa8d27"
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const form = document.getElementById('studentForm');
  const assignedSlot = document.getElementById('assignedSlot');

  form.addEventListener('submit', e => {
    e.preventDefault();
    const studentName = document.getElementById('studentName').value.trim();
    const partnerName = document.getElementById('partnerName').value.trim();

    if (!studentName || !partnerName) return alert('Both names are required!');

    // --- Get available days ---
    db.ref('days').once('value', snapshot => {
      const days = [];
      snapshot.forEach(daySnap => {
        const day = daySnap.key;
        const maxGroups = daySnap.val().maxGroups || 0;
        const slots = daySnap.val().slots || {};
        const assignedGroups = daySnap.val().assignedGroups || 0;
        if (assignedGroups < maxGroups) {
          days.push({day, slots: Object.values(slots)});
        }
      });

      if (days.length === 0) return alert('No available slots!');

      // --- Pick random day and slot ---
      const chosenDay = days[Math.floor(Math.random()  days.length)];
      const chosenSlot = chosenDay.slots[Math.floor(Math.random()  chosenDay.slots.length)];

      // --- Save group ---
      const groupData = {
        student: studentName,
        partner: partnerName,
        day: chosenDay.day,
        slot: chosenSlot
      };

      // Increment assignedGroups
      const groupRef = db.ref('groups').push();
      groupRef.set(groupData);

      // Update assignedGroups counter
      const assignedRef = db.ref('days/' + chosenDay.day + '/assignedGroups');
      assignedRef.transaction(current => (current || 0) + 1);

      assignedSlot.textContent = `Your group slot: ${chosenDay.day} at ${chosenSlot}`;
      form.reset();
    });
  });
</script>
</body>
</html>
