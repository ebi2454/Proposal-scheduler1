<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Proposal Scheduler</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        form { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; }
        input { margin-bottom: 10px; padding: 5px; width: 200px; }
        button { padding: 5px 10px; }
        #assignedSlot { font-weight: bold; margin-top: 20px; }
        #allAssignments { margin-top: 30px; }
    </style>
</head>
<body>
    <h2>Student Proposal Slot Booking</h2>

    <form id="studentForm">
        <label>Your Name: <input type="text" id="studentName" required></label>
        <label>Partner Name: <input type="text" id="partnerName" required></label>
        <button type="submit">Get Random Slot</button>
    </form>

    <p id="assignedSlot"></p>
    <div id="allAssignments"></div>

    <script>
        // استفاده از داده‌های ادمین اگر موجود باشد
        const schedule = window.adminSchedule || {
            "2025-11-20": { maxGroups: 3, slots: ["09:00","10:00","11:00"], assignedGroups: [] },
            "2025-11-21": { maxGroups: 2, slots: ["09:00","10:00"], assignedGroups: [] },
            "2025-11-22": { maxGroups: 1, slots: ["10:00"], assignedGroups: [] }
        };

        const allGroups = [];

        document.getElementById('studentForm').addEventListener('submit', e => {
            e.preventDefault();
            const studentName = document.getElementById('studentName').value.trim();
            const partnerName = document.getElementById('partnerName').value.trim();

            if (!studentName || !partnerName) {
                alert('Both names are required!');
                return;
            }

            const availableDays = Object.keys(schedule).filter(day =>
                schedule[day].assignedGroups.length < schedule[day].maxGroups
            );

            if (availableDays.length === 0) {
                alert('No available slots!');
                return;
            }

            const chosenDay = availableDays[Math.floor(Math.random()  availableDays.length)];
            const dayInfo = schedule[chosenDay];

            const availableSlots = dayInfo.slots.filter(slot =>
                !dayInfo.assignedGroups.includes(slot)
            );

            if (availableSlots.length === 0) {
                alert('No available slots for this day, retry!');
                return;
            }

            const chosenSlot = availableSlots[Math.floor(Math.random()  availableSlots.length)];

            const group = { student: studentName, partner: partnerName, day: chosenDay, slot: chosenSlot };
            dayInfo.assignedGroups.push(chosenSlot);
            allGroups.push(group);

            document.getElementById('assignedSlot').textContent =
                `Your group slot: ${chosenDay} at ${chosenSlot}`;

            const allAssignmentsDiv = document.getElementById('allAssignments');
            allAssignmentsDiv.innerHTML = "<h3>All Assigned Groups:</h3><ul>" +
                allGroups.map(g => `<li>${g.student} & ${g.partner}: ${g.day} at ${g.slot}</li>`).join('') +
                "</ul>";

            e.target.reset();
        });
    </script>
</body>
</html>
